.finalcard
  .title-item-testgo = @test.title

  .cont-finalcard
    .chart-finalcard
      canvas id="ResultChart"

    .likes-finalcard
      .title-comments-finalcard Like this test?
      a href="#like" Like
      a href="#dislike" Dislike

    .tests-finalcard.user
      .list-cont-user data-target-count=".js-user-count_passedtests"
        .full-list-cont-user
          - @tests.each do |test|
            = render "tests/item", item: test
          = render "tests/modal"

      / = render "tests/list", list: @tests
      /- @tests.each do |test|
        = render "tests/item", item: test
        / .test-finalcard
        /   = image_tag test.picture.url(:medium), class: "img-test-finalcard"

    = render "comments_list", list: @test.comments

javascript:
  (function( window, $ ) {
    var slidesCount = #{@test.slides.size};
    var answers = #{ @all_answers.map{|ans| ans.answers}.to_json   };
    var user_answer = #{ @user_answers.answers.to_json }
    var rate = [_.range(0,slidesCount,0),_.range(0,slidesCount,0),_.range(0,slidesCount,0)];
    //console.log(rate);

    var user_answer_labels = _.range(0,slidesCount,1);
    user_answer.forEach(function(val,ind) {
      if (val==0)
        user_answer_labels[ind]='No'
      else if (val==1)
        user_answer_labels[ind]='Yes'
      else if (val==2)
        user_answer_labels[ind]='Maybe'
    });


    answers.forEach(function(ans) {
      ans.forEach(function(value,ind){
        rate[value][ind]++;

        //console.log(value+' '+ind);
      })
    });
    user_answer.forEach(function(val,ind) {
      user_answer[ind] = rate[user_answer[ind]][ind]/(rate[0][ind]+rate[1][ind]+rate[2][ind])*100
    });

    var data = {};
    data.labels = user_answer_labels;
    data.datasets = [
        {
            label: "Number of no answers",
            fillColor: "rgba(255, 163, 172, 0.2)",
            strokeColor: "rgba(255, 163, 172, 1)",
            pointColor: "rgba(255, 163, 172, 1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
         //   data: rate[0]
        },
        {
            label: "Number of yes answers",
            fillColor: "rgba(163, 172, 255, 0.2)",
            strokeColor: "rgba(163, 172, 255, 1)",
            pointColor: "rgba(163, 172, 255, 1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
        //    data: rate[1]
        },
        {
            label: "Number of maybe answers",
            fillColor: "rgba(172,255,163,0.2)",
            strokeColor: "rgba(172,255,163,1)",
            pointColor: "rgba(172,255,163,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: user_answer
        }
    ];

    var ctx = document.getElementById("ResultChart").getContext("2d");
    var steps = 10, max = 100;
    var myNewChart = new Chart(ctx).Line(data, {
      scaleLabel: "<%=value%>%",
      scaleOverride: true,
      scaleSteps: steps,
      scaleStepWidth: Math.ceil(max / steps),
      scaleStartValue: 0,
      responsive: true
    });
  })( window, jQuery );
